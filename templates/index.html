{% if options.frame == 'true' %}
{% include "templates/framed-header.html" %}
{% else %} 
{% include "templates/header.html" %}
{% endif %}

<style>{% include "templates/quiz-body.css" %}</style>

    {% for row in data %}

        <div class="question" data-answer="{{row.answer}}">{{ row.question|safe }}
        {% for key, item in row.option %}
            <button class="answer-option" data-selected="false">{{ item }}</button>
        {% endfor %}
            {% if row.answercopy %}<div class="answer incomplete"> {{ row.answercopy }} </div>{% endif %}
        </div>
    {% endfor %}
    <div class="result"></div>

{% if options.frame == 'true' %}
{% include "templates/framed-footer.html" %}
{% else %} 
{% include "templates/footer.html" %}
{% endif %}

    </body>
    <script>
        
    (function(){  //wire up the quiz
        var tally = {
            correct: 0,
            incorrect: 0,
            total: document.querySelectorAll('.question').length
        };

        document.querySelectorAll('.question')
            .forEach((questionContainer,i)=>{
                var answer = questionContainer.dataset.answer;
                questionContainer.querySelectorAll('.answer-option')
                    .forEach((e,j)=>{
                        e.onclick = buttonClick(answer, questionContainer);
                    });
            });

        function buttonClick(correctAnswer, parent){
            return function(ev){
                if(ev.target.innerHTML == correctAnswer){
                    tally.correct ++;
                    ev.target.className = "option correct";
                }else{
                    tally.incorrect ++;
                    ev.target.className = "option incorrect";
                }

                parent.querySelectorAll(':scope > button')
                    .forEach((b)=>{
                        b.disabled = true;
                    });

                parent.querySelector(':scope > .answer')
                    .className = 'answer complete';

                complete();
            }
        }

        function complete(){
            if((tally.correct + tally.incorrect) === tally.total){
                document.querySelector('.result')
                    .innerHTML = 'You scored ' + tally.correct + '/' + (tally.incorrect + tally.correct);
            }
        }
    })();
    </script>
</html>